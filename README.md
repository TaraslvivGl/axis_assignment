## Overview
The purpose of the application is to retrieve the current image from the Axis device and transfer it to the HTTP server.

![Scheme of the example](assets/overall_schema.jpg)

The application(`AxisDataRetriever`) consists of: 
* HTTP client for handling the HTTP request. Curl library is used.
* Axis Image - a class that helps to manipulate files with raw image data.
* Utils - additional functionality: encode/decode to Base64, load configuration from the config file, and work with XML files.

To run the application the [configs.xml](config/configs.xml) file must be provided.

Steps to be performed when the application is run:
1) Load configs.xml file.
2) Send a GET request to retrieve the raw image from the Axis device.
3) Endcode raw image to Base64.
4) Pack the encoded image to an XML file according to the defined format.
5) Send XML file to the HTTP server with a POST request.

### Axis side
To retrieve the data from the Axis device the [Native SDK](https://axiscommunications.github.io/acap-documentation/docs/api/native-sdk-api.html) is used.
The following applications are build and uploaded to the Axis device:

* [vdoencoderclient](https://github.com/AxisCommunications/acap-native-sdk-examples/tree/main/vdostream) - is used for getting the current camera raw image in an appropriate format.
* [fastcgi_example](https://github.com/AxisCommunications/acap-native-sdk-examples/tree/main/web-server-using-fastcgi). The application is used with a [patch](axis/fastcgi_example.patch). It acts as a server that returns a current image(in formate y800) from the camera on HTTP request. The image is generated by calling the `vdoencoderclient` (`vdoencodeclient --format y800 --frames 1 --output vdo.out`).

## Build&Run

### Prerequisites
Upload `fastcgi_example_1_0_0_armv7hf.eap` and `vdoencodeclient_1_0_0_armv7hf.eap` to Axis device.

Run `fastcgi_example_1_0_0_armv7hf` on Axis device

Set `IP address`, `user` and `password` in `config/configs.xml` file.

Run http server
```
python2 http_server/http-server.py 8080
```

### Build
```
cmake -B build
cmake --build build
```

### Run
Do not forget to set `IP address`, `user`, and `password` in `config/configs.xml` file

```
build/AxisDataRetriever config/configs.xml
```
